<p-toast></p-toast>

<div class="w-full bg-white py-8 px-8 border border-gray-300 rounded-lg">

  <!-- Encabezado + acciones -->
  <div class="flex items-center justify-between mb-6">
    <h2 class="text-lg font-semibold text-neutral-900">Productos</h2>

    <div class="flex items-center gap-3">
      <button (click)="toggleFilters()"
              class="px-4 py-2 rounded-xl border border-neutral-300 text-sm font-semibold text-neutral-900 hover:bg-neutral-50">
        FILTRAR
      </button>

      <input type="search"
             placeholder="Buscar productos..."
             class="px-3 py-2 rounded-xl border border-neutral-300 w-[260px] text-neutral-900 placeholder:text-neutral-400"
             [formControl]="form.controls.q" />

      <select class="px-3 py-2 rounded-xl border border-neutral-300 text-sm text-neutral-900 bg-white"
              [formControl]="form.controls.sort">
        <option value="newest">Más nuevos</option>
        <option value="price_asc">Precio ↑</option>
        <option value="price_desc">Precio ↓</option>
      </select>

      <span class="text-sm text-neutral-500" *ngIf="!loading">
        {{ total }} resultado{{ total === 1 ? '' : 's' }}
      </span>
    </div>
  </div>

  <!-- Drawer de filtros -->
  <div class="fixed inset-0 z-40" *ngIf="openFilters">
    <div class="absolute inset-0 bg-black/40" (click)="toggleFilters()"></div>

    <aside
      class="absolute right-0 top-0 h-full w-[340px] bg-white shadow-xl p-5 overflow-y-auto text-neutral-900">
      <div class="flex items-center justify-between mb-4">
        <h3 class="font-bold text-neutral-900">Filtros</h3>
        <button (click)="toggleFilters()" class="text-sm underline text-neutral-700">Cerrar</button>
      </div>

      <!-- Precio -->
      <div class="mb-5">
        <h4 class="text-xs font-semibold text-neutral-700 mb-2">PRECIO</h4>
        <div class="flex gap-3">
          <input type="number"
                 class="w-1/2 px-3 py-2 rounded-xl border border-neutral-300 text-neutral-900 placeholder:text-neutral-400"
                 placeholder="$ mín."
                 [formControl]="form.controls.precioMin">
          <input type="number"
                 class="w-1/2 px-3 py-2 rounded-xl border border-neutral-300 text-neutral-900 placeholder:text-neutral-400"
                 placeholder="$ máx."
                 [formControl]="form.controls.precioMax">
        </div>
        <p class="text-xs text-neutral-500 mt-2">
          Rango: {{priceMinMax.min | currency:'ARS'}} – {{priceMinMax.max | currency:'ARS'}}
        </p>
      </div>

      <!-- Animal -->
      <div class="mb-5" *ngIf="animals.length">
        <h4 class="text-xs font-semibold text-neutral-700 mb-2">ANIMAL</h4>
        <div class="flex flex-col gap-2 max-h-44 overflow-auto pr-1">
          <label class="flex items-center gap-2" *ngFor="let a of animals">
            <input type="checkbox"
                   class="accent-violet-600"
                   [checked]="form.value.animal?.includes(a)"
                   (change)="toggleCheck('animal', a, $event.target.checked)">
            <span class="text-sm text-neutral-800">{{ a }}</span>
          </label>
        </div>
      </div>

      <!-- Clasificación -->
      <div class="mb-5" *ngIf="clasifs.length">
        <h4 class="text-xs font-semibold text-neutral-700 mb-2">CLASIFICACIÓN</h4>
        <div class="flex flex-col gap-2 max-h-44 overflow-auto pr-1">
          <label class="flex items-center gap-2" *ngFor="let c of clasifs">
            <input type="checkbox"
                   class="accent-violet-600"
                   [checked]="form.value.clasificacion?.includes(c)"
                   (change)="toggleCheck('clasificacion', c, $event.target.checked)">
            <span class="text-sm text-neutral-800">{{ c }}</span>
          </label>
        </div>
      </div>

      <div class="flex gap-3 mt-4">
        <button
          class="flex-1 px-4 py-2 rounded-xl bg-violet-600 text-white font-semibold hover:bg-violet-700 transition"
          (click)="toggleFilters()">
          APPLY
        </button>
        <button
          class="px-4 py-2 rounded-xl border border-neutral-300 text-neutral-800 hover:bg-neutral-50 transition"
          (click)="resetFilters()">
          RESET
        </button>
      </div>
    </aside>
  </div>

  <!-- Grid: loading skeleton -->
  <div *ngIf="loading" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
    <div *ngFor="let _ of [1,2,3,4,5,6,7,8]" class="animate-pulse">
      <div class="w-full h-60 bg-neutral-200 rounded-xl mb-3"></div>
      <div class="h-4 bg-neutral-200 rounded w-3/4 mb-2"></div>
      <div class="h-4 bg-neutral-200 rounded w-1/2"></div>
    </div>
  </div>

  <!-- Grid: productos -->
  <div *ngIf="!loading && productos?.length" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
    <app-card-productos-list
      *ngFor="let producto of productos"
      [producto]="producto">
    </app-card-productos-list>
  </div>

  <!-- Vacío -->
  <div *ngIf="!loading && (!productos || !productos.length)" class="py-16 text-center">
    <p class="text-neutral-600 mb-4">No encontramos productos para mostrar.</p>
    <button
      class="inline-flex items-center px-4 py-2 rounded-xl border border-neutral-300 hover:bg-neutral-50 text-sm font-semibold text-neutral-900"
      (click)="listarProductos()">
      Reintentar
    </button>
  </div>
</div>
